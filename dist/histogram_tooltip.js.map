{"version":3,"sources":["../src/histogram_tooltip.js"],"names":["HistogramTooltip","elem","dashboard","scope","getSeriesFn","self","ctrl","panel","$tooltip","$","findHoverIndexFromDataPoints","posX","series","last","ps","datapoints","pointsize","initial","len","points","length","j","Math","max","findHoverIndexFromData","bars","barWidth","data","showTooltip","title","innerHtml","pos","body","html","place_tt","pageX","pageY","getMultiSeriesPlotHoverInfo","seriesList","value","i","hoverIndex","results","last_value","legend","hideEmpty","allIsNull","push","hidden","hideZero","allIsZero","x","time","stack","tooltip","value_type","lines","steps","newhoverIndex","mouseleave","shared","plot","detach","unhighlight","sharedCrosshair","publishAppEvent","bind","event","item","plotData","getData","group","hoverInfo","seriesHtml","tooltipFormat","msResolution","seriesHoverInfo","highlightClass","seriesIndex","formatValue","color","label","highlight","datapoint"],"mappings":"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","file":"histogram_tooltip.js","sourcesContent":["import $ from 'jquery';\n\nexport default function HistogramTooltip(elem, dashboard, scope, getSeriesFn) {\n  var self = this;\n  var ctrl = scope.ctrl;\n  var panel = ctrl.panel;\n\n  var $tooltip = $('<div id=\"tooltip\" class=\"graph-tooltip\">');\n\n  this.findHoverIndexFromDataPoints = function(posX, series, last) {\n    var ps = series.datapoints.pointsize;\n    var initial = last*ps;\n    var len = series.datapoints.points.length;\n    for (var j = initial; j < len; j += ps) {\n      if (series.datapoints.points[j] > posX) {\n        return Math.max(j - ps,  0)/ps;\n      }\n    }\n    return j/ps - 1;\n  };\n\n  this.findHoverIndexFromData = function(posX, series) {\n    posX = posX + series.bars.barWidth / 2;\n    var len = series.data.length;\n    for (var j = 0; j < len; j++) {\n      if (series.data[j][0] > posX) {\n        return Math.max(j - 1,  0);\n      }\n    }\n    return j - 1;\n  };\n\n  this.showTooltip = function(title, innerHtml, pos) {\n    var body = '<div class=\"graph-tooltip-time\">'+ title + '</div>';\n    body += innerHtml + '</div>';\n    $tooltip.html(body).place_tt(pos.pageX + 20, pos.pageY);\n  };\n\n  this.getMultiSeriesPlotHoverInfo = function(seriesList, pos) {\n    var value, i, series, hoverIndex;\n    var results = [];\n\n    //now we know the current X (j) position for X and Y values\n    var last_value = 0; //needed for stacked values\n\n    for (i = 0; i < seriesList.length; i++) {\n      series = seriesList[i];\n\n      if (!series.data.length || (panel.legend.hideEmpty && series.allIsNull)) {\n        results.push({ hidden: true });\n        continue;\n      }\n\n      if (!series.data.length || (panel.legend.hideZero && series.allIsZero)) {\n        results.push({ hidden: true });\n        continue;\n      }\n\n      hoverIndex = this.findHoverIndexFromData(pos.x, series);\n      results.time = series.data[hoverIndex][0];\n\n      if (series.stack) {\n        if (panel.tooltip.value_type === 'individual') {\n          value = series.data[hoverIndex][1];\n        } else if (!series.stack) {\n          value = series.data[hoverIndex][1];\n        } else {\n          last_value += series.data[hoverIndex][1];\n          value = last_value;\n        }\n      } else {\n        value = series.data[hoverIndex][1];\n      }\n\n      // Highlighting multiple Points depending on the plot type\n      if (series.lines.steps || series.stack) {\n        // stacked and steppedLine plots can have series with different length.\n        // Stacked series can increase its length on each new stacked serie if null points found,\n        // to speed the index search we begin always on the last found hoverIndex.\n        var newhoverIndex = this.findHoverIndexFromDataPoints(pos.x, series, hoverIndex);\n        results.push({ value: value, hoverIndex: newhoverIndex });\n      } else {\n        results.push({ value: value, hoverIndex: hoverIndex });\n      }\n    }\n\n    return results;\n  };\n\n  elem.mouseleave(function () {\n    if (panel.tooltip.shared) {\n      var plot = elem.data().plot;\n      if (plot) {\n        $tooltip.detach();\n        plot.unhighlight();\n      }\n    }\n\n    if (dashboard.sharedCrosshair) {\n      ctrl.publishAppEvent('clearCrosshair');\n    }\n  });\n\n  elem.bind(\"plothover\", function (event, pos, item) {\n    var plot = elem.data().plot;\n    var plotData = plot.getData();\n    var seriesList = getSeriesFn();\n    var group, value, hoverInfo, i, series, seriesHtml, tooltipFormat;\n\n    if (panel.tooltip.msResolution) {\n      tooltipFormat = 'YYYY-MM-DD HH:mm:ss.SSS';\n    } else {\n      tooltipFormat = 'YYYY-MM-DD HH:mm:ss';\n    }\n\n    if (dashboard.sharedCrosshair) {\n      ctrl.publishAppEvent('setCrosshair', { pos: pos, scope: scope });\n    }\n\n    if (seriesList.length === 0) {\n      return;\n    }\n\n    if (panel.tooltip.shared) {\n      plot.unhighlight();\n\n      var seriesHoverInfo = self.getMultiSeriesPlotHoverInfo(plotData, pos);\n\n      seriesHtml = '';\n\n      for (i = 0; i < seriesHoverInfo.length; i++) {\n        hoverInfo = seriesHoverInfo[i];\n\n        if (hoverInfo.hidden) {\n          continue;\n        }\n\n        var highlightClass = '';\n        if (item && i === item.seriesIndex) {\n          highlightClass = 'graph-tooltip-list-item--highlight';\n        }\n\n        series = seriesList[i];\n\n        value = series.formatValue(hoverInfo.value);\n\n        seriesHtml += '<div class=\"graph-tooltip-list-item ' + highlightClass + '\"><div class=\"graph-tooltip-series-name\">';\n        seriesHtml += '<i class=\"fa fa-minus\" style=\"color:' + series.color +';\"></i> ' + series.label + ':</div>';\n        seriesHtml += '<div class=\"graph-tooltip-value\">' + value + '</div></div>';\n        plot.highlight(i, hoverInfo.hoverIndex);\n      }\n\n      self.showTooltip(seriesHoverInfo.time, seriesHtml, pos);\n    }\n    // single series tooltip\n    else if (item) {\n      series = seriesList[item.seriesIndex];\n      group = '<div class=\"graph-tooltip-list-item\"><div class=\"graph-tooltip-series-name\">';\n      group += '<i class=\"fa fa-minus\" style=\"color:' + item.series.color +';\"></i> ' + series.label + ':</div>';\n\n      if (panel.stack && panel.tooltip.value_type === 'individual') {\n        value = item.datapoint[1] - item.datapoint[2];\n      }\n      else {\n        value = item.datapoint[1];\n      }\n\n      value = series.formatValue(value);\n\n      group += '<div class=\"graph-tooltip-value\">' + value + '</div>';\n\n      self.showTooltip(item.datapoint[0], group, pos);\n    }\n    // no hit\n    else {\n      $tooltip.detach();\n    }\n  });\n}\n"]}